[![Community badge: Stable](https://img.shields.io/badge/Lifecycle-Stable-brightgreen)](https://github.com/Camunda-Community-Hub/community/blob/main/extension-lifecycle.md#stable-)
[![Community extension badge](https://img.shields.io/badge/Community%20Extension-An%20open%20source%20community%20maintained%20project-FF4700)](https://github.com/camunda-community-hub/community)
![Compatible with: Camunda Platform 8](https://img.shields.io/badge/Compatible%20with-Camunda%20Platform%208-0072Ce)


# camunda-8-connector-sendBPMNmessage

A Camunda 8 Connector to send a BPMN Message



## Principle
Send a BPMN Message

## Inputs

| Name                 | Description                                        | Class            | Default | Level     |
|----------------------|----------------------------------------------------|------------------|---------|-----------|
| messageName          | Name of message to send, used to find the receiver | java.lang.String |         | REQUIRED  |
| messageId            | Message Id                                         | java.lang.String |         | OPTIONAL  | 
| correlationVariables | Correlation value (1)                              | java.lang.String |         | OPTIONAL  |
| MessageVariables     | Expression to get the variable expression (2)      | java.lang.String |         | REQUIRED  | 
| messageDuration      | Duration of message on server                      | java.lang.String |         | OPTIONAL  |


(1) *CorrelationVariables*
If the receiver is a intermediate catch event message, a correlation is mandatory to find the process instance to unfreeze.

(2) *MessageVariables*:

Variables to copy in the message. The format is "(<variableName>=<value>)*
An string can be done explicitly
To give the value, a constant can be used
`````
statusTransferExpense=Correct,dateTransferExpense=2024/12/05,amountTransfer=453
`````

In general, values of variables are not a constant. So, to pass value, use a [Feel](https://docs.camunda.io/docs/components/modeler/feel/what-is-feel/) Expression can be provided:
`````
= "statusTransferExpense="+statusTransfer+",dateTransferExpense="+dateTransfer+", amountTransfer="+amount
`````

where `statusTransfer`, `dateTransfer` and `amount` are process variables.

Attention, [Feel](https://docs.camunda.io/docs/components/modeler/feel/what-is-feel/) expression accept only string:
Variables `statusTransfer`, `dateTransfer` must be **String** processes variable.

If not, the complete expression returns null, without any information.

To avoid this and use any kind of variable, use a constant expression with placeholder `${<processVariable>}`.

For example, in the expression:

`````
statusTransferExpense=${statusTransfer}, dateTransferExpense=${dateTransfer}, amountTransfer=${amount}
`````

`statusTransfer` will be replace by its value, a String, `dateTransfer` can be a Date, and `amount` a double.

See test/resources/SendMessage.bpmn"


## Output
| Name       | Description                         | Class             | Level    |
|------------|-------------------------------------|-------------------|----------|
| messageKey | Key generated by Zeebe              | java.lang.Long    | REQUIRED |
| tenantId   | Tenant ID which capture the message | java.lang.String  | REQUIRED |


## BPMN Errors

| Name                          | Explanation                                                                              |
|-------------------------------|------------------------------------------------------------------------------------------|
| INCORRECT_VARIABLE_DEFINITION | Incorrect variable expression definition. The value must be a list of (name=variable,)+  |
| SEND_MESSAGE                  | Error during the send operation                                                          |


# Build

```bash
mvn clean package
```

## Deployment
Two jars are produced after build. The jar with all dependencies is the one we will use.

### Cherry Frameowrk
Upload the jar in the [Cherry Framework](https://github.com/camunda-community-hub/zeebe-cherry-framework)

### Connector-Runtime

You can use camunda's [connector-runtime](https://docs.camunda.io/docs/self-managed/setup/guides/running-custom-connectors/#modify-connectors-config) to deploy your connector by adding the following to connectors helm values:


```
    env:
      - name: LOGGING_LEVEL_ROOT
        value: "INFO"
      - name: CONNECTOR_SENDBPMNMESSAGE_FUNCTION
        value: io.camunda.connector.message.SendBPMNMessageFunction
      - name: CONNECTOR_SENDBPMNMESSAGE_TYPE
        value: "c-send-message"
      - name: ZEEBE_CLIENT_BROKER_GATEWAY_ADDRESS
        value: "cntxt-zeebe-zeebe-gateway:26500"       
    ## @param connectors.initContainers can be used to set up extra init containers for the application Pod
    initContainers:
      - name: send-bpmn-message
        image: curlimages/curl
        args:
          - "-o"
          - "/opt/custom/send-bpmn-message-1.3.0-with-dependencies.jar"
          - "https://hosted-link.com/send-bpmn-message-1.3.0-with-dependencies.jar"
        volumeMounts:
          - name: init-script
            mountPath: /opt/custom
        securityContext:
          runAsUser: 1000
          runAsGroup: 1000

    ## @param connectors.extraVolumes can be used to define extra volumes for the Connectors pods, useful for TLS and self-signed certificates
    extraVolumes:
      - name: init-script
        emptyDir: {}
        
    ## @param connectors.extraVolumeMounts can be used to mount extra volumes for the Connectors pods, useful for TLS and self-signed certificates
    extraVolumeMounts:
      - mountPath: /opt/custom/send-bpmn-message-1.3.0-with-dependencies.jar
        name: init-script
        subPath: send-bpmn-message-1.3.0-with-dependencies.jar

```

# Element Template

The element template can be found in the [element-templates](element-templates) directory.

# Example

![SendMessageOperations.png](doc%2FSendMessageOperations.png)

This process send a message `Pay employee` without any correlation.

The second process send back a message `Transfer done` with a correlation key.
